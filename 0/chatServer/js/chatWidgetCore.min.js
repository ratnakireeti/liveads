function lpPatch_IE8(){"function"!=typeof Array.prototype.indexOf&&(Array.prototype.indexOf=function(e,t){for(var n=t||0,i=this.length;i>n;n++)if(this[n]===e)return n;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})}window.lpCWTag=window.lpCWTag||{},window.lpCWTagConst=window.lpCWTagConst||{};var lpMTagConfig=lpMTagConfig||{};lpMTagConfig.vars=lpMTagConfig.vars||[],lpCWTag.LPChatWidget=lpCWTag.LPChatWidget||function(e){function t(){Qe.debug("Resetting all variables"),ze=!0,lt=13,pt=!0,gt=!1,ht=!1,Ye="",Ke="",je="",tt="",nt=yt.READY,ot=!1,st=!1}function n(){Be=null,_e=null,delete Be,delete _e}function r(e){return"#"+e}function o(){var t=e.location!=e.parent.location?document.referrer:document.location.href;return t.indexOf("https")>-1?"https://"+t.substr(8).split("/")[0]:"http://"+t.substr(7).split("/")[0]}function s(e,t){var n=$.trim($(r(e)).val());return t&&$(r(e)).val(""),n}function a(){Me({lpEmbChatWiz:"LPNVPF",CMD:"CONTROL",value:"HIDE_CONTAINER"})}function u(){Qe.debug("showChatWizContainer"),Me({lpEmbChatWiz:"LPNVPF",CMD:"CONTROL",value:"SHOW_CONTAINER"})}function l(){if(Qe.debug("chatOverHandler"),_e)try{_e.unbind("onLoad",null,D),_e.unbind("onInit",null,w),_e.unbind("onInfo",null,R),_e.unbind("onLine",null,g),_e.unbind("onState",null,d),_e.unbind("onStart",null,I),_e.unbind("onAgentTyping",null,c),_e.unbind("onExitSurvey",null,N),_e.unbind("onPreChatSurvey",null,O),_e.unbind("onVisitorDisposed",null,A),_e.unbind("onRequestChat",null,_),_e.unbind("onStop",null,x),Qe.debug("chatOverHandler unbind successfully")}catch(e){Qe.debug("chatOverHandler exception found: "+e)}}function d(e){if(Qe.debug("updateChatState",e),nt!=yt.DESTRUCTION){var t=ke;ke=e.state,e.state&&t!=e.state&&$e.setChatState(e.state),ke==_e.chatStates.CHATTING?(tt=St.CHATTING,pt=!1,Z(),ee(),u()):ke==_e.chatStates.ENDED?U():ke==_e.chatStates.RESUMING?(We(Ue.lpChatMakeMessageSection(ze),!0),u(),pt=!1):ke==_e.chatStates.NOTFOUND&&(Qe.debug("updateChatState screenState ",tt),tt==St.CHATTING?(f(lpCWTagConst.lpMsg_ChatSessionEnded),pt=!0):tt==St.PRECHATSURVEY||tt==St.EXITSURVEY||(Qe.debug("updateChatState unexpected state"),l(),U()))}else Qe.debug("updateChatState skip as widget currently in ",yt.DESTRUCTION)}function c(e){Qe.debug("agentTyping",e),e.agentTyping?$(r(mt)).css("visibility","visible"):$(r(mt)).css("visibility","hidden")}function v(e){var t="";if("system"==e.source){var n=e.text;n.indexOf("You are now chatting with")>-1&&(n="<div style='padding:5px 0;font-weight:bold;'>"+n+"</div>"),t="<div class='lpChatInfoText'>"+n+"</div>"}else"visitor"==e.source?t=Ue.lpChatMakeRightSideMessage("You",e.text,lt):"agent"==e.source&&(t=Ue.lpChatMakeLeftSideMessage(e.by,e.text,lt));return t}function p(e,t){$(r(At)).append(e),t&&Y()}function C(){Qe.debug("scrollToBottom"),$(r(At)).length&&$(r(At)).animate({scrollTop:$(r(At))[0].scrollHeight},1e3)}function g(e){Qe.debug("addLines",e);var t=!1;if("undefined"!=typeof e.lines){for(var n=0;n<e.lines.length;n++){var i=e.lines[n];if("visitor"!=i.source||gt||(gt=!0),"visitor"!=i.source||ke!=_e.chatStates.CHATTING){var o=v(i);if("system"==i.source){var s=$(Wt+":last");$(Wt).is(":last-child")||($(r(At)).append('<div class="lpSystemMessageDiv"></div>'),s=$(Wt+":last")),s.append(o)}else p(o,!0);t=!0}}t&&(C(),Ne())}}function h(e){var t="****************",n=/[0-9]{13,16}/,i=/[0-9]{4}[\-\x20\.][0-9]{4}[\-\x20\.][0-9]{4}[\-\x20\.][0-9]{4}/,r=/[0-9]{4}[\-\x20\.][0-9]{6}[\-\x20\.][0-9]{5}/,o=/[0-9]{3}[\-\x20\.][0-9]{4}[\-\x20\.][0-9]{4}[\-\x20\.][0-9]{2}/,s=/[0-9]{4}[\-\x20\.][0-9]{4}[\-\x20\.][0-9]{3}[\-\x20\.][0-9]{2}/;return lpCWTagConst.CC_MASKING_ENABLE?e.replace(n,t).replace(i,t).replace(r,t).replace(o,t).replace(s,t):e}function f(e){var t=Ue.lpChatMakeInfoNotificationMessage("Info",e,lt);$(r(At)).append(t),C()}function S(){var e=s(Pt,!0),t=e;if(e=h(e),e&&_e&&"Type here..."!=e&&ke==_e.chatStates.CHATTING){var n=v({by:_e.getVisitorName(),text:e,source:"visitor",time:(new Date).toString()});_e.addLine({text:e,error:function(){n.className="error"}}),t!=e&&f(lpCWTagConst.lpMsg_CreditCardPatternDetected_InChat),p(n,!1),C()}}function y(t){t=t||e.event;var n=t.keyCode||t.which;if(13==n)return"keyup"==t.type&&(S(),T(!1)),!1;var i=s(Pt,!1);ht||""==i?ht&&""==i&&T(!1):T(!0)}function b(){S(),T(!1)}function T(e){_e&&ke==_e.chatStates.CHATTING&&(Qe.debug("visitor is typing"),_e.setVisitorTyping({typing:e}),ht=!!e)}function E(){return!!gt}function I(e){Qe.debug("onStart",e)}function m(){if(Qe.debug("createChatInstance"),Qe.debug("Starting lpChatAccountNumber: "+lpCWTagConst.lpChatAccountNumber+", lpChatAppKey: "+lpCWTagConst.lpChatAppKey),lpCWTagConst.lpChatAccountNumber&&lpCWTagConst.lpChatAppKey&&!_e)try{var e={lpNumber:lpCWTagConst.lpChatAccountNumber,appKey:lpCWTagConst.lpChatAppKey,domain:lpCWTagConst.domain,sessionUID:et,onLoad:D,onInit:w,onInfo:R,onLine:g,onState:d,onStart:I,onStop:x,onAgentTyping:c,onExitSurvey:N,onPreChatSurvey:O,onSubmitExitSurvey:P,onVisitorDisposed:A,onRequestChat:_,context:Fe};Qe.debug("createChatInstance param",e),_e=new lpTag.taglets.ChatOverRestAPI(e)}catch(t){return void Qe.debug("ERROR","Failed to create ChatOverRestAPI instance! "+t)}}function A(e){Qe.debug("onVisitorDisposed",e)}function P(e){Qe.debug("onSubmitExitSurvey",e)}function O(e){Qe.debug("onPreChatSurvey",e)}function N(e){Qe.debug("onExitSurvey",e)}function R(e){Qe.debug("onInfo",e),e.error&&xe.open(lpCWTagConst.lpMsg_OnInfoEventErrorMsg,!0)}function D(e){Qe.debug("onLoad",e),ke=e.state}function M(){Me({lpEmbChatWiz:"LPNVPF",CMD:"CONTROL",value:"CHAT_STATE_INACTIVE"})}function w(e){Qe.debug("onInit",e),ot=!0,nt==yt.DESTRUCTION?q():(e.init&&Me({lpEmbChatWiz:"LPNVPF",CMD:"CONTROL",value:"CHAT_STATE_ACTIVE"}),"uninitialised"==ke&&e.init&&""==$e.getChatState()&&("offline"==Xe?""==Ye?re(Xe):""!=Ye&&ie(Ye):vt||Pe()))}function q(){Qe.debug("cleanupPreviousSession","..."),Qe.debug("cleanupPreviousSession","chatInstanceReady="+ot+" collaborationInstanceReady="+st+" windowState = "+nt),nt==yt.DESTRUCTION?ot&&st&&(Qe.debug("cleanupPreviousSession start to clean previous session","..."),Be&&Be.stopSession(),_e&&_e.disposeVisitor(),l(),n(),$e.stop(),t(),Qe.debug("cleanupPreviousSession complete cleaning previous session","...")):Qe.debug("cleanupPreviousSession not ready to clean up previous session","...")}function W(){var e={error:function(e){te(e,lpCWTagConst.lpMsg_APICallFailure)}};Le&&(e.visitorId=Le),ct&&(e.rtSessionId=ct),Qe.debug("startSession reqParam",e);var t=Be.createSession(e);t&&t.error&&(Qe.debug("Collab startSession error",t.error),te(t,lpCWTagConst.lpMsg_APICallFailure))}function x(){if(Qe.debug("stopSession","...."),Be){var e=Be.stopSession();e&&e.error&&Qe.debug("Collab stopSession error",e.error),Qe.debug("stopSession"," successfully")}}function k(){pt=!0,""!=Ye?se(Ye):oe(Xe)}function L(e){if(Qe.debug("establishRequestChat with surveyResults",e),_e){var t={success:function(e){ze=!0,W()},error:function(e){Qe.debug("checkForPreChatSurvey.error",e),k()},context:Fe};"undefined"!=typeof e&&null!=e&&e.question&&e.question.length>0&&(t.survey=e),t.skill=Xe,t.chatReferrer=dt,t.visitorSessionId=ct,t.siteContainer=Ct,t.runWithRules=!0,Le&&(t.visitorId=Le),Qe.debug("chatRequest parameters: ",t),pt=!1;var n=_e.requestChat(t);$e.start(),n&&n.error&&(Qe.debug("checkForPreChatSurvey.error2",n),k())}}function _(e){Qe.debug("onRequestChatEvent",e),Ce(e),"undefined"!=typeof e&&"undefined"!=typeof e.error&&"undefined"!=typeof e.error.reason&&"no-available-agents"==e.error.reason&&(""!=Ye?ie(Ye):re(Xe))}function B(){Qe.info("dispose end chat","..."),Me({lpEmbChatWiz:"LPNVPF",CMD:"CONTROL",value:"END_CHAT"}),We("",!0),l(),n(),t()}function H(){Me({lpEmbChatWiz:"LPNVPF",CMD:"CONTROL",value:"UPDATE_DRAG_AREA_HIDE_PCI"}),$(r($t)).remove()}function F(){Qe.debug("lpChatCloseChatBtnClick","...chatWinCloseable="+pt),"undefined"!=typeof He&&clearInterval(He),H(),pt?($e.deleteChatSessionStorage(),B()):(ke==_e.chatStates.WAITING&&(pt=!0,We("",!0),a()),Q())}function U(){Qe.debug("endChatHandler","..."),M(),$e.stop(),H(),pt?B():ae(),Be&&Be.stopSession(),_e&&_e.disposeVisitor()}function Q(){if(Qe.debug("endChat","...chatState="+ke),!_e||ke!=_e.chatStates.CHATTING&&ke!=_e.chatStates.RESUMING&&ke!=_e.chatStates.WAITING)ke==_e.chatStates.INITIALISED&&U();else{var e={disposeVisitor:!0,context:Fe,skill:Xe,error:function(e){Qe.debug("endChat.error",e),pt=!0,U()}},t=_e.endChat(e);t&&t.error&&(Qe.debug("endChat.error2",t),pt=!0,U())}}function V(){lt=lt==ut?ut:2+lt,z()}function G(){lt=lt==at?at:lt-2,z()}function z(){var e=lt+"px";$e.setFontSize(lt),$("div.lpChatMsg").css("font-size",e)}function X(){Qe.debug("changeAudioSetting",ze),ze=!ze,$e.setAudio(ze),ze?($(".sprite-font-sound-off").addClass("sprite-font-sound-on").removeClass("sprite-font-sound-off"),$(r(Lt)).attr("data-msg",lpCWTagConst.lpTxt_TurnOffSound)):($(".sprite-font-sound-on").addClass("sprite-font-sound-off").removeClass("sprite-font-sound-on"),$(r(Lt)).attr("data-msg",lpCWTagConst.lpTxt_TurnOnSound))}function Y(){if(ze){try{isHTML5="undefined"!=typeof document.createElement("audio").play,myBeepAudio=new Audio("sound/incomingMessage.mp3"),myBeepAudio.play()}catch(e){isHTML5=!1}try{isIE=navigator.userAgent.toLowerCase().indexOf("msie")>-1}catch(e){isIE=!1}}}function K(e,t,n){Qe.debug("registerEventHandler",e+" "+t);try{$(r(e)).on(t,n)}catch(i){Qe.debug("Exception in registerEventHandler elementID="+e+", EventType="+t+" & error message",i)}}function j(e,t,n){Qe.debug("unregisterEventHandler",e+" "+t);try{$(r(e)).off(t,n)}catch(i){Qe.debug("Exception in unregisterEventHandler elementID="+e+", EventType="+t+" & error message",i)}}function Z(){"undefined"!=$(r(Pt)).attr("disabled")&&$(r(Pt)).removeAttr("disabled"),"undefined"!=$(r(Pt)).attr("onKeyup")&&(j(Pt,"keyup",y),K(Pt,"keyup",y))}function J(){try{Qe.debug("bindCloseButtonEvent","remove existing events"),j(Ot,"click",F),K(Ot,"click",F),Ue.isPostMessageSupported()||(Qe.debug("bindCloseButtonEvent","remove existing events"),$(r(Ot)).hide())}catch(e){Qe.debug("Exception in bindCloseButtonEvent, error message",e)}}function ee(){Qe.debug("bindAllButtonEvents","binding..."),J(),j(Rt,"click",G),j(Dt,"click",V),j(Lt,"click",X),j(Nt,"click",b),K(Rt,"click",G),K(Dt,"click",V),K(Lt,"click",X),K(Nt,"click",b),$(".lpHoverButton").on("mouseover",function(){$("body").append(Ue.lpMakeHoverDiv($(this).attr("data-msg")));var e=$(this).offset().top+$(this).height(),t=$(this).offset().left-$(".lpHoverDiv").width()/2+$(this).width()/2;if(0>=t){var n=t;t=0,$(".lpHoverDiv .lpArrowUp").css({left:n})}$(".lpHoverDiv").css({top:e,left:t})}).on("mouseout",function(){$(".lpHoverDiv").remove()})}function te(e,t){Qe.debug("showAPICallFailure",e),We(Ue.lpChatMakeOfflineScreenHtml(t),!0),u()}function ne(e,t){Qe.debug("showAPICallFailureInPopup",e),xe.open(t,!0)}function ie(e){se(e)}function re(e){oe(e)}function oe(e){var t={skill:e,success:Fe.showOverrideOfflineScreen,error:function(e){te(e,lpCWTagConst.lpMsg_APICallFailure)},context:Fe};Qe.debug("checkOfflineBySkill","requeParam="+e);var n=_e.getOfflineSurvey(t);n&&n.error&&te(n,lpCWTagConst.lpMsg_APICallFailure)}function se(e){Qe.debug("checkOfflineBySurveyName","surveyName="+e);var t=_e.getOfflineSurvey({surveyName:e,success:Fe.showOverrideOfflineScreen,error:function(e){te(e,lpCWTagConst.lpMsg_APICallFailure)},context:Fe});t&&t.error&&te(t,lpCWTagConst.lpMsg_APICallFailure)}function ae(){var e={success:Fe.showPostChatSurvey,error:Fe.noPostChatSurvey,context:Fe};E()?""!=je?e.surveyName=je:e.skill=Xe:e.surveyName=Je,Qe.debug("checkForPostChatSurvey param",e);var t="";E()?(Qe.debug("checkForPostChatSurvey","interactive chat detected"),t=_e.getExitSurvey(e)):(Qe.debug("checkForPostChatSurvey","none-interative chat detected"),pt=!0,t=_e.getExitSurvey(e)),t&&t.error&&te(t,lpCWTagConst.lpMsg_APICallFailure_Exit)}function ue(){Qe.debug("checkForPreChatSurvey","...");var e={success:Fe.showPreChatSurvey,error:Fe.noPreChatSurvey,context:Fe};""!=Ke?e.surveyName=Ke:e.skill=Xe,Qe.debug("checkForPreChatSurvey w/ param",e);var t=_e.getPreChatSurvey(e);t&&t.error&&(Qe.debug("checkForPreChatSurvey.error",t),""!=Ye?se(Ye):oe(Xe))}function le(e){Qe.debug("lpOnOfflineSurveySubmit","...");var t=ce(e),n={id:s("lpSurveyID",!1),question:t};Qe.debug("lpOnOfflineSurveySubmit.surveyResult",n);var i=function(e){B()},r={survey:n,success:i,error:function(e){ne(e,lpCWTagConst.lpMsg_APICallFailure_SubmitSurvey)}},o=_e.submitOfflineSurvey(r);o.error&&ne(o,lpCWTagConst.lpMsg_APICallFailure_SubmitSurvey)}function de(e){if(Qe.debug("lpOnPreChatSurveySubmit",e),ke==_e.chatStates.NOTFOUND&&tt==St.PRECHATSURVEY)Qe.debug("lpOnPreChatSurveySubmit","with NOT FOUND status"),""!=Ye?se(Ye):oe(Xe);else{var t=ce(e),n={id:s("lpSurveyID",!1),question:t};Qe.debug("lpOnPreChatSurveySubmit surveyResult",n),$(r(kt)).hide(),$(r(kt)).remove(),ve(n)}}function ce(e){Qe.debug("lpChatGetSurveyAnswers","...");var t=new Array,n=new Array,i=0;if(e.survey&&e.survey.questions&&e.survey.questions.question&&e.survey.questions.question.length>0)for(var r=0;r<e.survey.questions.question.length;r++){var o=e.survey.questions.question[r],s="#lpChatSurveySectionQ"+o.order;if($(s).is(":visible")){n.push(o.id);var a="#lpSurveyQuestionAns"+o.order;$(a).length&&(t[i++]={id:o.id,answer:qe(o,o.order)})}}return Qe.debug("Active Questions ID List Answered",n),t}function ve(e){Qe.debug("lpPrepareChat","...."),We(Ue.lpChatMakeMessageSection(ze)),Qe.debug("lpOnPreChatSurveySubmit.surveyResult",e),L(e),ee()}function pe(e){Qe.debug("lpPostChatSurveySubmit","....");var t=ce(e);if(ke==_e.chatStates.NOTFOUND&&tt==St.EXITSURVEY)Qe.debug("lpPostChatSurveySubmit","with NOT FOUND state"),B();else{var n={id:s("lpSurveyID",!1),question:t},i=function(e){B()},r={skill:Xe,survey:n,context:Fe,success:i,error:function(e){ne(e,lpCWTagConst.lpMsg_APICallFailure_SubmitSurvey)}};r.visitorSessionId=ct,Qe.debug("exitSurvey parameters: ",r);var o=_e.submitExitSurvey(r);o.error&&ne(o,lpCWTagConst.lpMsg_APICallFailure_SubmitSurvey)}}function Ce(e){return Qe.debug("setGlobalVisitorId visitorId=",Le),Le?void Qe.debug("setGlobalVisitorId visitorId=",Le+" already exist"):(e&&e.info&&e.info.visitorId?(Le=e.info.visitorId,Qe.debug("setGlobalVisitorId visitorId[1]",e.info.visitorId)):e&&e.visitorId&&(Le=e.visitorId,Qe.debug("setGlobalVisitorId visitorId[2]",e.visitorId)),$e.setVisitorID(Le),void C())}function ge(e){Qe.debug("prechatSurveyBtnClick","submitted"),xe.isOpen()&&(Qe.debug("showPreChatSurvey","notification is on"),xe.close()),Fe.validateSurvey(e,de)}function he(e){Qe.debug("offlineSurveyBtnClick","submitted"),Fe.validateSurvey(e,le)}function fe(e){Qe.debug("exitSurveyBtnClick","submitted"),Fe.validateSurvey(e,pe)}function Se(e){var t=new lpTag.taglets.SurveyLogic({survey:e}),n=t.getActiveQuestionsIds();if(e.survey.questions){var r=new Array;for(i=0;i<e.survey.questions.question.length;i++)question=e.survey.questions.question[i],n.indexOf(question.id)>-1&&(r.push(question.id),ye(e,question,!0));Qe.debug("Active Questions ID List",r)}}function ye(e,t,n){var i=(e.survey.questions,"lpChatSurveySectionQ"+t.order),o="lpChatSurveySectionQError"+t.order,s='<div id="'+i+'" class="lpChatSurveySectionQ">',a='<div class="lpChatSurveySectionQdesc">';if(lpCWTagConst.lpUseAutoGenNumberOnSurvey&&(a+=questionIndex++ +". "),a+=t.label,t.mandatory&&(a+='<span class="lpRequiredTxt">&nbsp;*</span>'),a+=Ue.makeHiddenInput("lpSurveyQuestionID"+t.order,t.id),a+="</div>",s+=a,s+=Ue.makeInputSection(ft,t,t.order),s+="</div>",s+='<div id="'+o+'" class="lpErrorMessage"></div>',$(r(qt)).append(s),n?$(r(i)).show():$(r(i)).hide(),t.entry&&t.entry.length){for(var u in t.entry){var l=t.entry[u];if(l.logic&&l.logic.showLogicId){var d=l.logic.showLogicId;for(var c in d){var v=d[c],p=be(e,v);p&&ye(e,p,!1)}}}Te(e,t)}Ie(e,t)}function be(e,t){for(var n in e.survey.questions.question){var i=e.survey.questions.question[n];if(i.logicId==t)return i}}function Te(e,t){if(t){var n="#lpSurveyQuestionAns"+t.order;$(n).change(function(){me(e,t.id)})}}function Ee(e,t,n){if(""!=n&&t&&t.type==ft.TEXT||t.type==ft.TEXT_AREA){var i=h(n);i!=n&&xe.open(lpCWTagConst.lpMsg_CreditCardPatternDetected_InSurvey,!0)}}function Ie(e,t){if(t&&t.type==ft.TEXT||t.type==ft.NUMERIC||t.type==ft.TEXT_AREA){var n="#lpSurveyQuestionAns"+t.order;$(n).blur(function(){var i=$(n).val();""!=i.trim()?(Ee(e,t,i.trim()),Ue.surveyQuestionHideRequired(ft,t,!1)):Ue.surveyQuestionShowRequired(ft,t)})}else me(e,t)}function me(e,t){var n=new lpTag.taglets.SurveyLogic({survey:e}),i=n.getQuestionById(t),r=qe(i,i.order);"object"!=typeof r&&(r=[],r[0]=qe(i,i.order)),r.length>0&&""==r[0]?Ue.surveyQuestionShowRequired(ft,i):Ue.surveyQuestionHideRequired(ft,i,!1);for(var o in r){var s=r[o];for(var a in i.entry){var u=i.entry[a];if(s==u.value&&u.logic&&u.logic.showLogicId)for(var l=u.logic.showLogicId.length-1;l>=0;l--){var d=n.getQuestionByLogicId(u.logic.showLogicId[l]);jQuery.isEmptyObject(d)||$("#lpChatSurveySectionQ"+d.order).show()}}}Ae(ft,e,i)}function Ae(e,t,n){var i=new lpTag.taglets.SurveyLogic({survey:t}),r=qe(n,n.order);for(var o in n.entry){var s=n.entry[o];if(-1==r.indexOf(s.value)&&s.logic&&s.logic.showLogicId)for(var a=0;a<s.logic.showLogicId.length;a++){var u=i.getQuestionByLogicId(s.logic.showLogicId[a]);jQuery.isEmptyObject(u)||(Ue.surveyQuestionHideRequired(e,u,!0),Ue.surveyQuestionHideReqRedBorder(e,u,!0),Ae(e,t,u))}}}function Pe(){$(r($t)).hide();var e=function(e){Qe.debug("getAgentAvailabilty ",e),e.availability?(Qe.debug("getAvailabilty","true"),ue()):(Qe.debug("getAvailabilty","false"),""!=Ye?ie(Ye):re(Xe))},t=function(e){Qe.debug("getAgentAvailabilty.error",e),""!=Ye?se(Ye):oe(Xe)},n=_e.getAvailabilty({skill:Xe,success:e,error:t,context:Fe});n&&n.error&&(Qe.debug("getAgentAvailabilty.error2",n.error),""!=Ye?se(Ye):oe(Xe))}function Oe(e){return o()==e}function Ne(){Qe.debug("lpChatWinNotifyFlashingStart"," notifying..."+o()),Ve&&!Ge&&(Me({lpEmbChatWiz:"LPNVPF",CMD:"FLASHING",value:"START"}),Ge=!0)}function Re(){Ve=!0}function De(){Ve=!1,Ge=!1,C()}function Me(t){Qe.debug("childFrame sending PostMessage to: "+o(),t),e.parent.postMessage(JSON.stringify(t),o())}function we(e,t){if("alpha_numeric"==e)return t;if("email"==e){var n=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return n.test(t)}return"numeric"==e?!isNaN(t):void 0}function qe(e,t){var n;if(e.type==ft.TEXT||e.type==ft.TEXT_AREA||e.type==ft.NUMERIC||e.type==ft.DROPDOWN){if(n=$("#lpSurveyQuestionAns"+t).val().trim(),"alpha_numeric"==e.validationType){n=h(n)}}else if(e.type==ft.CHECKBOX){var i=$("#lpSurveyQuestionAns"+t);i.find("input:checked").length&&(n=[],i.find("input:checked").each(function(){n.push($(this).val())}))}else if(e.type==ft.RADIO||e.type==ft.RADIO_SIDE){var i=$("#lpSurveyQuestionAns"+t);n=i.find("input:checked").val()}return n||""}function We(e,t){t&&$(r(It)).html(""),$(r(It)).append(e)}var $e,xe,ke,Le,_e,Be,He,Fe=this,Ue=new lpCWTag.LPChatWidgetAssist(e),Qe=new lpCWTag.LPChatWidgetLogger,Ve=!1,Ge=!1,ze=!0,Xe="offline",Ye="",Ke="",je="",Ze="",Je="",et="",tt="",nt="",it=!0,rt=!1,ot=!1,st=!1,at=11,ut=15,lt=13,dt="",ct="",vt=!0,pt=!0,Ct="",gt=!1,ht=!1,ft={CHECKBOX:"Checkbox",RADIO:"Radio Button",RADIO_SIDE:"Radio Button (side by side)",TEXT:"Text Field",TEXT_AREA:"Text Area",NUMERIC:"Numeric Field",DROPDOWN:"Dropdown Box"},St={NONE:"",PRECHATSURVEY:"PRECHAT_SURVEY",CHATTING:"CHATTING",EXITSURVEY:"EXIT_SURVEY"},yt={READY:"READY",DESTRUCTION:"DESTRUCTION"},bt="lpChatiFrame",Tt="lpChatWizContainer",Et="lpChatWizFrameContainer",It="lpChatBodySection",mt="lpChatAgentType",At="lpChatMessagesSection",Pt="lpChatInputTextField",Ot="lpPreChatCloseBtn",Nt="lpSendChatBtn",Rt="lpChatMenuItemFontDecreaseBtn",Dt="lpChatMenuItemFontIncreaseBtn",Mt="lpSurveyTotalQuestNum",wt="lpSurveyID",qt="lpSurveyQuestionsContainer",Wt=".lpSystemMessageDiv",$t="lpChatSlideOutContainer",xt=".lpChatSurveySectionText",kt="lpPreChatMessagesSection",Lt="lpChatMenuItemAudioBtn";Fe.init=function(){Qe.debug("initializing..."),_e=null,nt=yt.READY,xe=new lpCWTag.LPChatWidgetNotification,$e=new lpCWTag.LPChatWidgetSessionManager(e)},Fe.getChatWizContainerElement=function(){return e.parent.$(r(Tt))},Fe.getiFrameElement=function(){return e.parent.$(r(bt))[0]},Fe.getChatWizFrameContainerElement=function(){return e.parent.$(r(Et))},Fe.showOverrideOfflineScreen=function(e){Qe.debug("showOverrideOfflineScreen",e),We(Ue.lpChatMakeOfflineSurveySection(e),!0),J(),null!=e.survey.questions&&(Se(e),$(r(wt)).val(e.survey.id),$(r(Mt)).val(e.survey.questions?e.survey.questions.question.length:0),j("lpOfflineSurveySubmitBtn","click",function(){he(e)}),K("lpOfflineSurveySubmitBtn","click",function(){he(e)})),$e.stop(),u()},Fe.noPreChatSurvey=function(){Qe.debug("noPreChatSurvey","..."),We(Ue.lpChatMakeMessageSection(ze),!0),L(null),ee(),u()},Fe.showPreChatSurvey=function(e){Qe.debug("showPreChatSurvey",e),tt=St.PRECHATSURVEY,We(Ue.lpChatMakeSurveyContainerHtml(!1),!0),Se(e),$(r(kt)).find(xt).html(e.survey.header),$(r(wt)).val(e.survey.id),$(r(Mt)).val(e.survey.questions?e.survey.questions.question.length:0),Qe.debug("showPreChatSurvey","before bind close button event"),J(),Qe.debug("showPreChatSurvey","after bind close button event"),j("lpPreChatSurveySubmitBtn","click",function(){ge(e)}),K("lpPreChatSurveySubmitBtn","click",function(){ge(e)}),u()},Fe.noPostChatSurvey=function(){Qe.debug("noPostChatSurvey","..."),B()},Fe.showPostChatSurvey=function(e){Qe.debug("showPostChatSurvey",e),pt=!0,tt=St.EXITSURVEY,$(r("lpChatLoadingSection")).remove();var t=!!(e.survey.questions&&e.survey.questions.question.length>0);t?(We(Ue.lpChatMakeSurveyContainerHtml(!0),!0),$(r("lpPreChatSurveySubmitBtn")).text(lpCWTagConst.lpBtn_Submit),$(r("lpPreChatSurveySectionTitle")).addClass("lpPostChatTitleHeader"),Se(e),$(r(kt)).find(".lpChatSurveySectionTextPost").html(e.survey.header),$(r(wt)).val(e.survey.id),$(r(Mt)).val(e.survey.questions?e.survey.questions.question.length:0),j("lpPreChatSurveySubmitBtn","click",function(){fe(e)}),K("lpPreChatSurveySubmitBtn","click",function(){fe(e)})):We(Ue.lpChatMakeOfflineSurveySection(e),!0)},Fe.loadChat=function(){Qe.debug("loadChat","..."),ke=null,tt="",n(),m()},Fe.reEstChatConnection=function(){Qe.debug("reEstablishChat","..."),Ue.isBrowserCompatible()&&(nt=yt.READY,$e.reloadDataFromSessionStorage(),Qe.debug("reEstablishChat","isChatStarted="+($e.isChatStarted()?"true":"false")+", isActiveChatSession="+($e.isActiveChatSession()?"true":"false")),$e&&$e.isChatStarted()&&($e.isActiveChatSession()?(Qe.debug("reEstablishChat","actvie session and valid session found"),ze=$e.isAudioOn(),lt=$e.getFontSize(),et=$e.getSUID(),Ye=$e.getOfflineChatSurveyNameOverride(),Ke=$e.getPreChatSurveyNameOverride(),je=$e.getExitChatSurveyNameOverride(),ct=$e.getVisitorSessionID(),Le=$e.getVisitorID(),Xe=$e.getChatSkill(),$e.start(),ee()):(Qe.debug("reEstablishChat","previous session found"),nt=yt.DESTRUCTION,et=$e.getSUID(),Qe.info("reEstablishChat recreate with SUID",et)),m()))},Fe.lpReceiveChatPostMessage=function(e){lpCWTagConst.DEBUG_ENABLE&&Oe(e.origin)&&Qe.debug("lpReceiveChatPostMessageChild: ",e.data);try{var t=JSON.parse(e.data);"LPNVCF"==t.lpEmbChatWiz&&("LP_WEB_SERVICES"==t.CMD?(it=!0,rt="SUCCESS"==t.value):"FLASHING"==t.CMD?"MINIMIZED"==t.value?Re():"MAXIMIZED"==t.value&&De():"DEBUG"==t.CMD?"ENABLE"==t.value?lpCWTagConst.DEBUG_ENABLE=!0:lpCWTagConst.DEBUG_ENABLE=!1:"RE_ESTABLISH"==t.CMD?(Qe.debug("RE_ESTABLISH","..."),Fe.reEstChatConnection(),u()):"CONTROL"==t.CMD&&("lpStartChatButtonClicked"==t.value?Ue.isBrowserCompatible()?(Qe.debug("windowState - ",nt),nt==yt.READY?(null!=t.skill&&(Xe=t.skill),null!=t.offlineSurveyNameOverride&&(Ye=t.offlineSurveyNameOverride),null!=t.preChatSurveyNameOverride&&(Ke=t.preChatSurveyNameOverride),null!=t.exitChatSurveyNameOverride&&(je=t.exitChatSurveyNameOverride),null!=t.webserviceFailureOfflineSurveyNameOverride&&(Ze=t.webserviceFailureOfflineSurveyNameOverride),null!=t.nonInteractiveChatSurveyNameOverride&&(Je=t.nonInteractiveChatSurveyNameOverride),vt=!!t.WS_ENABLE,dt=t.lpChatWizButtonName,ct=t.lpVisitorSessionId,Ct=t.siteContainer,et=$.now(),$e.initialize(),$e.setChatWizParam(Xe,et,ct),$e.setChatWizSurveyParam(Ke,Ye,je),Fe.loadChat()):Qe.info("busy cleaning up previous session. Please try again in a few second",nt)):(We(Ue.lpChatMakeUpdateBrowserSection()),u(),J()):"HIDE_CONTAINER"==t.value?a():"END_CHAT"==t.value?F():"SCROLL"==t.value&&(Qe.debug("Preparing scrollToBottom....",""),C())))}catch(n){Qe.debug("lpReceiveChatPostMessage. Exception occurred",n)}},Fe.validateSurvey=function(e,t){Qe.debug("validateSurvey","....");var n=!0,r=!0;if(e.survey&&e.survey.questions&&e.survey.questions.question)for(i=0;i<e.survey.questions.question.length;i++){question=e.survey.questions.question[i];var o="";question.type==ft.TEXT||question.type==ft.NUMERIC||question.type==ft.TEXT_AREA?(o="#lpSurveyQuestionAns"+question.order,$(o).removeClass()):(o="#lpChatSurveySectionQ"+question.order,$(o).removeClass().addClass("lpChatSurveySectionQ"));var s="#lpChatSurveySectionQ"+question.order,a="#lpChatSurveySectionQError"+question.order;if($(a).empty(),$(s).is(":visible")){var u=qe(question,question.order);if(question.mandatory&&!u.length)n=!1,Ue.insertRequiredErrorMessage(question,r),r=!1,$(o).addClass("lpQuestionErrorBorder");else if(u.length&&question.validationType&&(question.type==ft.TEXT||question.type==ft.NUMERIC)){var l=we(question.validationType,u);l||(n=l,Ue.insertInvalidErrorMessage(question,r),r=!1,$(o).addClass("lpQuestionErrorBorder"))}}}return n&&t(e),n}},lpChatWidget=new lpCWTag.LPChatWidget(window),function(e){function t(){lpPatch_IE8(),lpChatWidget.init()}if(void 0===e.jQuery)throw new Error("JQuery is required!");e.addEventListener?e.addEventListener("message",lpChatWidget.lpReceiveChatPostMessage,!1):e.attachEvent&&e.attachEvent("onmessage",lpChatWidget.lpReceiveChatPostMessage),t()}(window);